<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用 js 裁剪 png 图片的透明边框 | hello vitepress</title>
    <meta name="description" content="这里是描述">
    <link rel="stylesheet" href="/assets/style.d78986b9.css">
    <link rel="modulepreload" href="/assets/Home.d7c17163.js">
    <link rel="modulepreload" href="/assets/app.b52713d1.js">
    <link rel="modulepreload" href="/assets/使用 js 裁剪 png 图片的透明边框.md.fb39fd07.lean.js">
    <link rel="modulepreload" href="/assets/app.b52713d1.js">
    <meta name="twitter:title" content="使用 js 裁剪 png 图片的透明边框 | hello vitepress">
    <meta property="og:title" content="使用 js 裁剪 png 图片的透明边框 | hello vitepress">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="hello vitepress, back to home" data-v-675d8756 data-v-4a583abe><!----> hello vitepress</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-15acbf05><!--[--><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/" data-v-b8818f8c>首页 <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/archives/" data-v-b8818f8c>归档 <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/tags/" data-v-b8818f8c>分类 <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/about/" data-v-b8818f8c>关于 <!----></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-15acbf05><!--[--><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/" data-v-b8818f8c>首页 <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/archives/" data-v-b8818f8c>归档 <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/tags/" data-v-b8818f8c>分类 <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/about/" data-v-b8818f8c>关于 <!----></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="#使用-js-裁剪-png-图片的透明边框">使用 js 裁剪 png 图片的透明边框</a><!----></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h2 id="使用-js-裁剪-png-图片的透明边框"><a class="header-anchor" href="#使用-js-裁剪-png-图片的透明边框" aria-hidden="true">#</a> 使用 js 裁剪 png 图片的透明边框</h2><blockquote><p>最近开发中遇到一个图片裁剪的需求，具体就是对 png 格式的图片进行处理，如果图片四周有透明部分，则对图片进行裁剪，仅保留有内容的矩形区域。查阅相关资料后使用 canvas 实现了该功能。</p></blockquote><p>首先我们知道图片是由一个个的像素点组成的，要想裁剪周围的透明边框，我们需要找到不透明区域的边界在什么位置，具体来说就是水平和垂直方向上从哪个位置开始出现不透明的像素点，又是到哪个位置以后不再出现不透明的像素点，这样水平方向和垂直方向开始结束的位置所围成的矩形区域就是我们需要裁剪的区域了。而 canvas 刚好能帮助我们实现该判断。</p><p>假设我们有一张宽为 w, 高为 h 的需要裁剪图片，首先需要创建一个 canvas 元素，并获取canvas 上下文，然后使用 canvas 的 getImageData api 获取图片信息。</p><div class="language-js"><pre><code><span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span>
canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> w
canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> h
<span class="token keyword">const</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;2d&#39;</span><span class="token punctuation">)</span>
ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> w<span class="token punctuation">,</span> h<span class="token punctuation">)</span>
<span class="token keyword">const</span> imgData <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> w<span class="token punctuation">,</span> h<span class="token punctuation">)</span>
</code></pre></div><p><code>imgData</code> 中有一个 <code>data</code> 属性，它是一个 Uint8ClampedArray, 类数组结构，每四个元素表示一个像素点信息，即像素点的 RGBA 值，所以可以看成一个 <code>[rgbargbargba...]</code> 这样的数组。如下图，每个格子代表一个像素点的话，data 就是一个从第一个 rgba 一直到最后一个 rgba 的数组，其中 a 代表的是当前像素点的 alpha 通道，即透明度。因此可以通过遍历每一个像素点来确认裁剪的边界。</p><p><img src="https://cdn.jsdelivr.net/gh/Zjinxing/image-galary/blog/%E6%88%AA%E5%B1%8F2022-05-29%2017.50.56.png" alt=""></p><p>通过以下方法找出边界：</p><div class="language-js"><pre><code><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 开始出现像素点的 x 坐标</span>
    y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 开始出现像素点的 y 坐标</span>
    maxX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 最后出现像素点的 x 坐标</span>
    maxY <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">// 最后出现像素点的 y 坐标</span>
<span class="token keyword">let</span> freezedY <span class="token operator">=</span> <span class="token boolean">false</span>


<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> h<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 像素行循环</span>
    <span class="token keyword">let</span> rowOpacity <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// 用于判断当前行是否全是透明</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> w<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 循环第 i 行像素点的每一列</span>
        <span class="token keyword">const</span> alpha <span class="token operator">=</span> imgData<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">*</span> w <span class="token operator">+</span> j<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">4</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>alpha <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 当前像素点不透明</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                x <span class="token operator">=</span> j
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token comment">// 取最小的 x 坐标</span>
            <span class="token punctuation">}</span>
            maxX <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>maxX<span class="token punctuation">,</span> j<span class="token punctuation">)</span> <span class="token comment">// 结束取最大的 y 坐标</span>
            rowOpacity <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 一行循环完毕，更新 y 坐标</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rowOpacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 一行循环完毕且尚未遇到有不透明像素的行，y++</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>freezedY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            y<span class="token operator">++</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        freezedY <span class="token operator">=</span> <span class="token boolean">true</span>
        maxY <span class="token operator">=</span> i
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> width <span class="token operator">=</span> maxX <span class="token operator">-</span> x <span class="token comment">// 裁剪区宽度</span>
<span class="token keyword">const</span> height <span class="token operator">=</span> maxY <span class="token operator">-</span> y <span class="token comment">// 裁剪区高</span>
</code></pre></div><p>这样就获取到了裁剪区的坐标及宽高，然后我们新建一个 canvas，就可以把裁剪部分保存下来了：</p><div class="language-js"><pre><code><span class="token keyword">const</span> rectImgData <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span> <span class="token comment">// 裁剪区数据</span>
<span class="token keyword">const</span> canvas1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span>
canvas1<span class="token punctuation">.</span>width <span class="token operator">=</span> width
canvas1<span class="token punctuation">.</span>height <span class="token operator">=</span> height
<span class="token keyword">const</span> ctx1 <span class="token operator">=</span> canvas1<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;2d&#39;</span><span class="token punctuation">)</span>
ctx1<span class="token punctuation">.</span><span class="token function">putImageData</span><span class="token punctuation">(</span>rectImgData<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> base64Img <span class="token operator">=</span> canvas1<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">&#39;image/png&#39;</span><span class="token punctuation">)</span>
</code></pre></div><p>这样就获取到了裁剪区域的 base64 数据了，可以根据需要把他保存到本地或者是展示在页面中。</p></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><!----></div></div><div class="updated" data-v-fb8d84c6><!----></div></footer><!----><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"git 多账户配置.md\":\"6b559e36\",\"intersectionobserver-infinitscroll.md\":\"a0cd59b7\",\"bubblesort.md\":\"23ed062f\",\"chat-input.md\":\"451f07ff\",\"clonedeep.md\":\"e3612a9d\",\"electron-rxdb.md\":\"21aead2b\",\"elementui-el-table-sort.md\":\"7b566a5f\",\"index.md\":\"d931ca38\",\"javascript-extends.md\":\"d7bca5fa\",\"miniprogram-swipe.md\":\"2fea09f6\",\"service-worker-push-message.md\":\"469706de\",\"vitepress-blog.md\":\"e11e8996\",\"vue3-reactive.md\":\"df47327f\",\"使用 js 裁剪 png 图片的透明边框.md\":\"fb39fd07\",\"公众号开发采坑总结.md\":\"05732ffe\",\"about_index.md\":\"edf36961\",\"archives_index.md\":\"2abd745d\",\"tags_index.md\":\"1bb5f711\"}")</script>
    <script type="module" async src="/assets/app.b52713d1.js"></script>
  </body>
</html>